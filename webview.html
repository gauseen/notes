<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>flutter webview</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
</head>
<body>

<section>
  <button id="jsCallFlutter1">扫码 1</button>
  <button id="jsCallFlutter2">扫码 2</button>

  <button id="getDeviceId">获取 ID 1</button>

  <ul id="scanList"></ul>
</section>

<script type="text/javascript">
  var $ = function (id) {
    return document.getElementById(id)
  }

  function jsCallFlutter1 () {
    flutterStartScan.postMessage('scanCallback1')
  }

  function jsCallFlutter2 () {
    flutterStartScan.postMessage('scanCallback2')
  }

  function getDeviceIdFun () {
    flutterGetDeviceId.postMessage('deviceIdCallback')
  }

  function scanCallback1 (args) {
    flutterCallJs('scanCallback_1', args)
  }

  function scanCallback2 (args) {
    flutterCallJs('scanCallback_2', args)
  }

  function deviceIdCallback (args) {
    flutterCallJs('deviceIdCallback_1', args)
  }

  var scanListEle = $('scanList')
  function flutterCallJs (callbackName, args) {
    var liEle = document.createElement('li')
    var value = document.createTextNode(callbackName + ': ' + args)
    liEle.appendChild(value)
    scanListEle.appendChild(liEle)
    return 'js return value'
  }

  $('jsCallFlutter1').addEventListener('click', function () {
    flutterApi('flutterStartScan').then((data) => {
      flutterCallJs('scanCallback_1', data)
    })
  })

  $('jsCallFlutter2').addEventListener('click', jsCallFlutter2)

  $('getDeviceId').addEventListener('click', getId)

  function getId () {
    flutterApi('flutterGetDeviceId').then((data) => {
      flutterCallJs('getDeviceId_1', data)
    })
  }

  getId()
  


  function flutterApi (namespace, options) {
    const callbackName = '__flutterCallback__'

    return new Promise((resolve, reject) => {
      window[callbackName] = resolve
      window[namespace].postMessage(callbackName)
    })
  }

  

</script>
</body>
</html>
